---
interface Props {
    href: string;
    label: string;
}

const { href, label } = Astro.props;
---

<a class="lang-switch" href={href} data-lang-switch>{label}</a>

<script is:inline>
    document.querySelectorAll("[data-lang-switch]").forEach((element) => {
        element.addEventListener("click", () => {
            const href = element.getAttribute("href") || "/";
            const newLocale = href.startsWith("/zh/") ? "zh-CN" : "en-US";
            localStorage.setItem("preferred-locale", newLocale);
        });

        const anchor = element;
        if (!(anchor instanceof HTMLAnchorElement)) {
            return;
        }

        const baseHref = anchor.getAttribute("href") || "/";
        const query = window.location.search;
        const hash = window.location.hash;
        anchor.href = `${baseHref}${query}${hash}`;
    });
</script>
